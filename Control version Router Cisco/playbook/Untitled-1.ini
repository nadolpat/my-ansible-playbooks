      - name: Backup running-config from router #เรียกใช้ show run และ เก็บค่า
        ios_command:
          commands: show running-config
        register: running_config

      - name: Restore config if drift detected
        ios_config:
          src: /etc/ansible/backups/router/latest-config.txt  # ใช้ไฟล์ config ล่าสุดจาก backup เพื่อ restore
        when: diff_output.stdout != ""    # เงื่อนไข: restore เมื่อแตกต่าง

      - name: Save backup with date
        copy:
          content: "{{ running_config.stdout[0] }}"  # นำค่าที่ดึงมาจาก running_config มาเขียนลงไฟล์
          dest: "/etc/ansible/backups/router/{{ lookup('pipe', 'date +%F') }}-config.txt"  

      - name: Update latest-config symlink
        file:
          src: "/etc/ansible/backups/router/{{ lookup('pipe', 'date +%F') }}-config.txt" 
          dest: "/etc/ansible/backups/router/latest-config.txt" 
          state: link
          # สร้าง symlink latest-config.txt ชี้ไปยัง backup ล่าสุด